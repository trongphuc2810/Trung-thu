<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Trung Thu ‚Äî Slide to Unlock üåï‚ú®</title>
<style>
  :root{ --ink:#e8f1ff; --accent:#ffd166; }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:ui-rounded, system-ui, -apple-system, "SF Pro Display","Segoe UI", Roboto, Arial; color:#fff; background: radial-gradient(1400px 900px at 70% -10%, #142449 10%, #0b1226 50%, #050812 100%)}
  #fw-bg{position:fixed; inset:0; width:100vw; height:100vh; z-index:2; filter:blur(2px) saturate(1.06); display:block;}
  .locker{position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); width:min(680px,88vw); z-index:4;}
  .track{position:relative; width:100%; height:72px; background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.18); border-radius:999px; box-shadow:inset 0 12px 28px rgba(0,0,0,.45), 0 14px 28px rgba(40,120,255,.08); overflow:hidden}
  .marquee{position:absolute; inset:0; display:grid; place-items:center; pointer-events:none; font-weight:800; letter-spacing:.3px; color:#d8e6ffcc; mask-image:linear-gradient(90deg, transparent, black 12%, black 88%, transparent); -webkit-mask-image:linear-gradient(90deg, transparent, black 12%, black 88%, transparent)}
  .marquee span{display:inline-block; white-space:nowrap; animation:scroll 6s linear infinite}
  @keyframes scroll{from{transform:translateX(20%)} to{transform:translateX(-20%)}}
  .handle{position:absolute; top:6px; left:6px; width:60px; height:60px; border-radius:999px; background:linear-gradient(135deg,#7fb0ff,#5a8dff); display:grid; place-items:center; box-shadow:0 10px 24px rgba(90,141,255,.55), inset 0 -6px 12px rgba(0,0,0,.25); touch-action:none; user-select:none; -webkit-user-select:none}
  .handle::after{content:"‚Ä∫"; font-size:30px; transform:translateX(2px); font-weight:900; color:#0a1533}
  .spark{position:absolute; inset:0; border-radius:inherit; box-shadow:0 0 70px 18px rgba(110,170,255,.20); pointer-events:none; opacity:.25}
  .reveal{position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); text-align:center; pointer-events:none; opacity:0; z-index:3}
  .reveal h2{margin:0; font-size:clamp(28px,7vw,68px); font-weight:900; letter-spacing:.4px; text-shadow: 0 1px 0 rgba(255,255,255,.25), 0 4px 10px rgba(255,255,255,.18), 0 12px 26px rgba(20,120,255,.18); filter: drop-shadow(0 12px 30px rgba(255,255,255,.18))}
  .reveal .sub{margin-top:12px; font-size:clamp(13px,2.2vw,18px); color:var(--ink); opacity:.9; text-shadow:0 2px 8px rgba(0,0,0,.35)}
  .reveal.show{animation:fadeIn 1.1s ease-out forwards}
  @keyframes fadeIn{from{opacity:0; transform:translate(-50%,-46%)} to{opacity:1; transform:translate(-50%,-50%)}}
  .fab{position:fixed; right:18px; top:18px; width:44px; height:44px; border-radius:999px; display:none; align-items:center; justify-content:center; background:rgba(16,24,43,.6); border:1px solid rgba(255,255,255,.12); backdrop-filter:blur(8px); box-shadow:0 10px 26px rgba(0,0,0,.35); z-index:5; cursor:pointer}
  .fab span{font-size:20px}
  .panel{position:fixed; right:14px; top:70px; width:min(420px,92vw); background:linear-gradient(180deg, rgba(16,24,43,.78), rgba(16,24,43,.66)); border:1px solid rgba(255,255,255,.12); border-radius:16px; box-shadow:0 14px 46px rgba(0,0,0,.5); backdrop-filter:blur(10px); padding:14px; display:none; z-index:5}
  .panel h3{margin:2px 0 10px; font-size:16px}
  .row{display:flex; gap:8px; align-items:center; margin-bottom:10px}
  .row input{flex:1; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); color:#fff; font-weight:600}
  .row button{background:#1b2a4a; border:none; color:#fff; padding:10px 12px; border-radius:10px; font-weight:700; cursor:pointer}
  .qr{width:110px; height:110px; border-radius:10px; background:#fff; padding:6px; border:1px solid rgba(255,255,255,.12)}
</style>
</head>
<body>
  <canvas id="fw-bg"></canvas>

  <div class="locker" id="locker">
    <div class="track" id="track">
      <div class="marquee"><span>‚üµ K√©o sang ph·∫£i ƒë·ªÉ m·ªü kh√≥a ‚Ä¢ Slide to unlock ‚Ä¢ Vu·ªët sang ph·∫£i ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√°o hoa ‚ú®</span></div>
      <div class="spark"></div>
      <div class="handle" id="handle" aria-label="slide to unlock"></div>
    </div>
  </div>

  <div class="reveal" id="reveal">
    <h2 id="headline">Ch√∫c b·∫°n Trung Thu an l√†nh, ƒëo√†n vi√™n v√† r·ªôn r√†ng ni·ªÅm vui!</h2>
    <div class="sub">Ch·∫°m/nh·∫•p ƒë·ªÉ t·∫°o th√™m ph√°o hoa</div>
  </div>

  <button class="fab" id="fab" title="Ch·ªânh l·ªùi ch√∫c / t·∫°o QR"><span>‚öôÔ∏è</span></button>
  <div class="panel" id="panel">
    <h3>Ch·ªânh l·ªùi ch√∫c & chia s·∫ª</h3>
    <div class="row">
      <input id="msg" placeholder="G√µ l·ªùi ch√∫c..." value="Ch√∫c b·∫°n Trung Thu an l√†nh, ƒëo√†n vi√™n v√† r·ªôn r√†ng ni·ªÅm vui!"/>
      <button id="apply">√Åp d·ª•ng</button>
    </div>
    <div class="row">
      <button id="qrBtn">T·∫°o QR</button>
      <img id="qrImg" class="qr" alt="QR" />
      <button id="fs">To√†n m√†n h√¨nh</button>
      <button id="closePanel">ƒê√≥ng</button>
    </div>
  </div>

<script>
// ==== Fireworks (slower, higher, with heart shapes) ====
const FW = (()=>{
  const canvas = document.getElementById('fw-bg');
  const ctx = canvas.getContext('2d');
  let W = canvas.width = window.innerWidth;
  let H = canvas.height = window.innerHeight;
  let running = false;
  const rand=(a,b)=>Math.random()*(b-a)+a;
  const rockets=[]; const particles=[];
  function resize(){ W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight; }
  window.addEventListener('resize', resize);

  class Particle{
    constructor(x,y,color,vx,vy,life,size){ this.x=x; this.y=y; this.vx=vx; this.vy=vy; this.life=life; this.ttl=life; this.color=color; this.size=size; }
    step(dt){ this.x+=this.vx*dt; this.y+=this.vy*dt + 0.10*dt; this.vx*=0.997; this.vy*=0.997; this.ttl-=dt; }
    draw(){ const a=Math.max(0,this.ttl/this.life); ctx.globalCompositeOperation='lighter'; ctx.fillStyle=`rgba(${this.color.r},${this.color.g},${this.color.b},${a})`; ctx.beginPath(); ctx.arc(this.x,this.y,Math.max(0.8,this.size*a),0,Math.PI*2); ctx.fill(); }
  }
  function palette(){ const p=[{r:255,g:210,b:80},{r:255,g:110,b:110},{r:130,g:210,b:255},{r:190,g:140,b:255},{r:255,g:150,b:220},{r:130,g:255,b:170}]; return p[(Math.random()*p.length)|0]; }

  function explodeCircle(x,y,color,size=2.0,count=130){
    for(let i=0;i<count;i++){ const a=Math.random()*Math.PI*2, s=rand(1.4,4.8)*size; particles.push(new Particle(x,y,color, Math.cos(a)*s, Math.sin(a)*s, rand(3.2,6.8), rand(2.0,4.2)*size)); }
  }
  function explodeHeart(x,y,color,size=2.2){
    const count = 180, rot = rand(0,Math.PI*2), cosr=Math.cos(rot), sinr=Math.sin(rot);
    for(let i=0;i<count;i++){
      const t = (i/count)*Math.PI*2;
      let hx = 16*Math.sin(t)**3;
      let hy = -(13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
      hx*=0.55*size; hy*=0.55*size;
      const rx = hx*cosr - hy*sinr, ry = hx*sinr + hy*cosr;
      const len = Math.hypot(rx,ry)||1, sp=rand(1.2,3.6);
      particles.push(new Particle(x,y,color, (rx/len)*sp, (ry/len)*sp, rand(3.6,7.2), rand(2.0,4.0)));
    }
  }
  const heartChance = 0.25;
  function explode(x,y,color){ if(Math.random()<heartChance) explodeHeart(x,y,color, rand(1.8,2.6)); else explodeCircle(x,y,color, rand(1.8,2.5), 130 + (Math.random()*60|0)); }

  function launch(x){
    const tx=(typeof x==="number")?x:rand(80,W-80);
    rockets.push({x:tx,y:H+36,vy:rand(-5,-3),life:rand(3.6,5.2),color:palette()});
  }

  let last=0, tAuto=0, nextInterval=rand(3.4,4.6);
  function loop(now){
    if(!running){ last=now; requestAnimationFrame(loop); return; }
    const dt=Math.min(.10,(now-last)/16.666); last=now; tAuto+=dt;
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle="rgba(6,10,20,0.16)"; ctx.fillRect(0,0,W,H);

    for(let i=rockets.length-1;i>=0;i--){
      const r=rockets[i];
      r.y+=r.vy*dt*60; r.vy+=0.06*dt*60;
      r.life-=dt;
      ctx.fillStyle=`rgba(${r.color.r},${r.color.g},${r.color.b},1)`;
      ctx.beginPath(); ctx.arc(r.x,r.y,3.0,0,Math.PI*2); ctx.fill();
      if(r.vy>=0 || r.y < H*0.28 || r.life<=0){ explode(r.x,r.y,r.color); rockets.splice(i,1); }
    }

    for(let i=particles.length-1;i>=0;i--){
      const p=particles[i]; p.step(dt);
      if(p.ttl<=0 || p.y>H+80) particles.splice(i,1); else p.draw();
    }

    if(tAuto>nextInterval){ tAuto=0; nextInterval=rand(3.4,4.6); launch(); }

    ctx.globalCompositeOperation='source-over';
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  canvas.addEventListener('click', (e)=>{
    if(!running) return;
    const r=canvas.getBoundingClientRect(), x=e.clientX-r.left, y=e.clientY-r.top;
    explode(x,y, palette());
  });

  return {
    start(){
      running=true;
      for(let i=0;i<2;i++) setTimeout(()=>launch(), 260*i);
      setTimeout(()=>{ explode(W*0.5, H*0.42, palette()); }, 800);
    },
    stop(){ running=false; }
  }
})();

// ==== Unlock & QR logic ====
(function(){
  const qs = new URLSearchParams(location.search);
  const defaultMsg = 'Ch√∫c m·ª´ng Trung Thu!';
  const locker = document.getElementById('locker');
  const track = document.getElementById('track');
  const handle = document.getElementById('handle');
  const reveal = document.getElementById('reveal');
  const fab = document.getElementById('fab');
  const panel = document.getElementById('panel');
  const msgInput = document.getElementById('msg');
  const applyBtn = document.getElementById('apply');
  const qrBtn = document.getElementById('qrBtn');
  const qrImg = document.getElementById('qrImg');
  const fsBtn = document.getElementById('fs');
  const closePanel = document.getElementById('closePanel');

  function setHeadline(txt){ document.getElementById('headline').textContent = txt || defaultMsg; }
  // init from ?msg=
  const msgFromUrl = qs.get('msg');
  if (msgFromUrl) {
    msgInput.value = msgFromUrl;
    setHeadline(msgFromUrl);
  }

  applyBtn?.addEventListener('click', ()=> setHeadline(msgInput.value.trim() || defaultMsg));

  function payloadForQR(){
    const isHttp = location.protocol === 'http:' || location.protocol === 'https:';
    const customUrl = qs.get('u'); // optional: force QR to encode a given URL
    if (customUrl) return customUrl;
    const currentMsg = msgInput.value.trim() || defaultMsg;
    if (isHttp) {
      const u = new URL(location.href);
      u.searchParams.set('msg', currentMsg);
      u.searchParams.set('edit', '0');
      return u.toString();
    } else {
      // opened via file:// -> return message text so scan v·∫´n ƒë·ªçc ƒë∆∞·ª£c
      return currentMsg;
    }
  }

  qrBtn?.addEventListener('click', ()=>{
    const data = payloadForQR();
    // d√πng api qrserver c√¥ng khai
    qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=${encodeURIComponent(data)}`;
  });

  fsBtn?.addEventListener('click', ()=>{ const el=document.documentElement; if(!document.fullscreenElement) el.requestFullscreen?.(); else document.exitFullscreen?.(); });
  closePanel?.addEventListener('click', ()=>{ panel.style.display='none'; });

  function togglePanel(show){ panel.style.display = (show===undefined ? (panel.style.display==='none'||panel.style.display===''?'block':'none') : (show?'block':'none')); }
  document.getElementById('fab').addEventListener('click', ()=> togglePanel());
  if(qs.get('edit') === '1'){ document.getElementById('fab').style.display = 'flex'; togglePanel(true); }

  let dragging=false, startX=0, left=6, max=0, pos=0;
  function measure(){ const w = track.clientWidth; max = w - handle.offsetWidth - 6; pos = 6; handle.style.left = pos + 'px'; }
  window.addEventListener('resize', measure); setTimeout(measure,0);
  function setLeft(x){ pos = Math.max(6, Math.min(x, max)); handle.style.left = pos + 'px'; }

  function unlock(){
    locker.style.pointerEvents='none'; locker.style.transition='opacity .35s ease'; locker.style.opacity='0'; setTimeout(()=>{ locker.style.display='none'; }, 380);
    FW.start(); setTimeout(()=>{ reveal.classList.add('show'); }, 1300);
    document.getElementById('fab').style.display = 'flex';
  }

  function onDown(e){ dragging=true; const clientX = e.touches? e.touches[0].clientX : e.clientX; startX = clientX - handle.getBoundingClientRect().left; e.preventDefault(); }
  function onMove(e){ if(!dragging) return; const clientX = e.touches? e.touches[0].clientX : e.clientX; const trackLeft = track.getBoundingClientRect().left; setLeft(clientX - trackLeft - startX); e.preventDefault(); }
  function onUp(){ if(!dragging) return; dragging=false; if(pos >= max - 6){ unlock(); } else setLeft(6); }

  handle.addEventListener('mousedown', onDown);
  handle.addEventListener('touchstart', onDown, {passive:false});
  window.addEventListener('mousemove', onMove, {passive:false});
  window.addEventListener('touchmove', onMove, {passive:false});
  window.addEventListener('mouseup', onUp);
  window.addEventListener('touchend', onUp);
})();
</script>
</body>
</html>
